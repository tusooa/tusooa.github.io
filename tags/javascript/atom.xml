<?xml version="1.0"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>http://tusooa.github.io</id>
    <title>何事西风不待人 • Posts by &#34;javascript&#34; tag</title>
    <link href="http://tusooa.github.io" />
    <updated>2020-10-10T20:55:15.000Z</updated>
    <category term="kde" />
    <category term="krita" />
    <category term="c++" />
    <category term="code" />
    <category term="firefox" />
    <category term="无奈" />
    <category term="坑" />
    <category term="javascript" />
    <category term="tech" />
    <category term="hexo" />
    <category term="css" />
    <category term="帜" />
    <category term="复杂" />
    <entry>
        <id>http://tusooa.github.io/2020/10/10/Some-multilingual-hacks-on-Hexo/</id>
        <title>&lt;span class=&#39;ts-langs-group&#39;&gt; &lt;span class=&#39;ts-lang-en ts-langs ts-langs-show ts-langs-block&#39;&gt; Some multilingual hacks on Hexo &lt;/span&gt; &lt;span class=&#39;ts-lang-zh-CN ts-langs ts-langs-show ts-langs-block&#39;&gt; 瞎折腾Hexo的多语言 &lt;/span&gt; &lt;/span&gt;</title>
        <link rel="alternate" href="http://tusooa.github.io/2020/10/10/Some-multilingual-hacks-on-Hexo/"/>
        <content type="html">&lt;style type=&#34;text/css&#34;&gt;.ts-langs:not(.ts-langs-show) { display: none; }&lt;/style&gt;&lt;p&gt;&lt;span class=&#39;ts-lang-en ts-langs ts-langs-show ts-langs-block&#39;&gt;I do not know why exactly I am so stubborn to insist on making this
site multilingual, and in a way that you may see multiple languages
at the same time. But it is something.&lt;/span&gt;
&lt;span class=&#39;ts-lang-zh-CN ts-langs ts-langs-block&#39;&gt;我自己也不明白为什么我执拗得一定要把这网站做成多语言的，还是叫人
能同时看到多种语言的那种。但聊胜于无吧。&lt;/span&gt;&lt;/p&gt;
&lt;a id=&#34;more&#34;&gt;&lt;/a&gt;
&lt;h1 id=&#34;A-weird-thing-about-HexoHexo-的诡异事件&#34;&gt;&lt;a href=&#34;#A-weird-thing-about-HexoHexo-的诡异事件&#34; class=&#34;headerlink&#34; title=&#34;A weird thing about HexoHexo 的诡异事件&#34;&gt;&lt;/a&gt;&lt;span class=&#39;ts-langs-group&#39;&gt;&lt;span class=&#39;ts-lang-en ts-langs ts-langs-show&#39;&gt;A weird thing about Hexo&lt;/span&gt;&lt;span class=&#39;ts-lang-zh-CN ts-langs&#39;&gt;Hexo 的诡异事件&lt;/span&gt;&lt;/span&gt;&lt;/h1&gt;&lt;p&gt;&lt;span class=&#39;ts-lang-en ts-langs ts-langs-show ts-langs-block&#39;&gt;The &lt;em&gt;first&lt;/em&gt; weird thing I got, when I was trying to figure out
&lt;a href=&#34;https://github.com/next-theme/hexo-theme-next&#34;&gt;hexo-theme-next&lt;/a&gt;: sometimes &lt;code&gt;hexo server&lt;/code&gt; gives
the perfect result, but when I &lt;code&gt;hexo generate&lt;/code&gt; or &lt;code&gt;hexo deploy&lt;/code&gt;,
nothing will be correct. Everything is just malformed, and it
does not change even if I &lt;code&gt;hexo clean&lt;/code&gt;.&lt;/span&gt;
&lt;span class=&#39;ts-lang-zh-CN ts-langs ts-langs-block&#39;&gt;我在折腾 &lt;a href=&#34;https://github.com/next-theme/hexo-theme-next&#34;&gt;hexo-theme-next&lt;/a&gt; 的时候碰到的第一个诡异事件是：
有时候 &lt;code&gt;hexo server&lt;/code&gt; 给出了个无懈可击的结果，但只要一 &lt;code&gt;hexo generate&lt;/code&gt;
或者 &lt;code&gt;hexo deploy&lt;/code&gt;，全完蛋。整个网站看着都非常诡异，甚至我
&lt;code&gt;hexo clean&lt;/code&gt; 了之后也没有丝毫变化。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span class=&#39;ts-lang-en ts-langs ts-langs-show ts-langs-block&#39;&gt;After digging a lot into the source code, and enabling &lt;code&gt;--debug&lt;/code&gt;,
I finally found that there are some backup files that are also
processed. And the content of those files &lt;em&gt;does&lt;/em&gt; correspond to
the wrong contents on the site. &amp;quot;Okay,&amp;quot; hereby I say, &amp;quot;this
behaviour is indeed ridiculous.&amp;quot;&lt;/span&gt;
&lt;span class=&#39;ts-lang-zh-CN ts-langs ts-langs-block&#39;&gt;钻进源码里东张西望了好久，再合着 &lt;code&gt;--debug&lt;/code&gt; 的加成，我终于看到了一些备份文件
也被处理了。而其内容&lt;strong&gt;确然&lt;/strong&gt;是应了网站上有问题的东西。「行吧，」如是我说，
「是事直令人齿冷。」&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span class=&#39;ts-lang-en ts-langs ts-langs-show ts-langs-block&#39;&gt;And thus I added the ignore rules to ignore all such files,
and everything is hopefully back in place.&lt;/span&gt;
&lt;span class=&#39;ts-lang-zh-CN ts-langs ts-langs-block&#39;&gt;所以我加了忽略规则来忽略这种文件，世界终于清净了，谢天谢地。&lt;/span&gt;&lt;/p&gt;
&lt;figure class=&#34;highlight yaml&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;attr&#34;&gt;ignore:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;quot;**/*~&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;quot;**/#*&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;bullet&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;quot;**/.#*&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h1 id=&#34;NexT-39-s-language-switcherNexT-的语言切换器&#34;&gt;&lt;a href=&#34;#NexT-39-s-language-switcherNexT-的语言切换器&#34; class=&#34;headerlink&#34; title=&#34;NexT&amp;#39;s language switcherNexT 的语言切换器&#34;&gt;&lt;/a&gt;&lt;span class=&#39;ts-langs-group&#39;&gt;&lt;span class=&#39;ts-lang-en ts-langs ts-langs-show&#39;&gt;NexT&amp;#39;s language switcher&lt;/span&gt;&lt;span class=&#39;ts-lang-zh-CN ts-langs&#39;&gt;NexT 的语言切换器&lt;/span&gt;&lt;/span&gt;&lt;/h1&gt;&lt;p&gt;&lt;span class=&#39;ts-lang-en ts-langs ts-langs-show ts-langs-block&#39;&gt;That is an even more terrible part that comes in. Yes,
&lt;a href=&#34;https://github.com/next-theme/hexo-theme-next&#34;&gt;NexT&lt;/a&gt; comes with such a thing called a
&amp;quot;language switcher,&amp;quot; but it never takes you to a right
place. I cannot even get Hexo generate pages for
different languages, no matter how I change the &lt;code&gt;language&lt;/code&gt;
parameter in &lt;code&gt;_config.yml&lt;/code&gt;. So whenever I click on the
language switcher, I got a 404. And it is hidden at the very
bottom of the page --- How should one expect their visitor
to dig into the deepest hole before they can switch languages?&lt;/span&gt;
&lt;span class=&#39;ts-lang-zh-CN ts-langs ts-langs-block&#39;&gt;这玩意儿甚至更可怕了。是是是，&lt;a href=&#34;https://github.com/next-theme/hexo-theme-next&#34;&gt;NexT&lt;/a&gt; 有个叫「语言切换器」
的东西，但是它总把人引入歧途。让 Hexo 给不同的语言分别生成页面，这我
怎么改 &lt;code&gt;_config.yml&lt;/code&gt; 里的 &lt;code&gt;language&lt;/code&gt; 参数，也弄不成。所以呢，每次
按下这语言切换器的时候，404 就浮现在我眼前了。而且这切换器给藏在了页面
最底下——让访客钻进最深的洞里才许其切换语言，这能成吗？&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span class=&#39;ts-lang-en ts-langs ts-langs-show ts-langs-block&#39;&gt;So, well, since NexT&amp;#39;s language switcher sucks, and multi-page
style multi-language implementation is not feasible, why not just
put everything all together? NexT at least provides a way to
customize what texts are shown... in &lt;code&gt;languages.yml&lt;/code&gt;.&lt;/span&gt;
&lt;span class=&#39;ts-lang-zh-CN ts-langs ts-langs-block&#39;&gt;啊啊，行吧，NexT 这语言切换器是糟透了，多页面显示多语言也办不到，那么把
所有东西全放一起，这又如何呢？NexT 至少给了个用 &lt;code&gt;languages.yml&lt;/code&gt; 来控制
显示什么文字的方法呀......&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span class=&#39;ts-lang-en ts-langs ts-langs-show ts-langs-block&#39;&gt;The main idea is to merge NexT&amp;#39;s default translations into one.
I made a Perl script for this. The text for every language is a
&lt;code&gt;span&lt;/code&gt;, and they are next to each other. Use css to put a divider
between every visible &lt;code&gt;span&lt;/code&gt;. Whether a language is shown is controlled
by a JavaScript program that adds or removes classes from the elements.&lt;/span&gt;
&lt;span class=&#39;ts-lang-zh-CN ts-langs ts-langs-block&#39;&gt;大意就是把 NexT 的默认翻译全整一起去。这事我写了个 Perl 脚本去做。每种语言的文字
装在一个 &lt;code&gt;span&lt;/code&gt; 里，并并排。用 css 在每个显示了的 &lt;code&gt;span&lt;/code&gt; 之间，摆一个分割线。
至于某种语言是显示呢是隐藏呢，这让 JavaScript 程序来控制，就从元素里加上或是减去
些 class 就好。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span class=&#39;ts-lang-en ts-langs ts-langs-show ts-langs-block&#39;&gt;As I am too lazy, the code is all &lt;a href=&#34;https://gitlab.com/tusooa/blog&#34;&gt;on GitLab&lt;/a&gt;.
Whether this is a viable implementation is left as an exercise
for the reader.&lt;/span&gt;
&lt;span class=&#39;ts-lang-zh-CN ts-langs ts-langs-block&#39;&gt;因为我太懒了，代码都在 &lt;a href=&#34;https://gitlab.com/tusooa/blog&#34;&gt;GitLab 上&lt;/a&gt;。这东西到底可行不，
留给读者作练习。&lt;/span&gt;&lt;/p&gt;

</content>
        <category term="坑" />
        <category term="javascript" />
        <category term="hexo" />
        <category term="css" />
        <updated>2020-10-10T20:55:15.000Z</updated>
    </entry>
    <entry>
        <id>http://tusooa.github.io/2020/10/01/Fix-firefox-address-bar-clickSelectsAll-bug/</id>
        <title>Fix firefox address bar clickSelectsAll bug (Spoiler: no re-compilation required.)</title>
        <link rel="alternate" href="http://tusooa.github.io/2020/10/01/Fix-firefox-address-bar-clickSelectsAll-bug/"/>
        <content type="html">&lt;p&gt;A couple of months ago, I opened my Firefox as usual, I found out that
when I click on the address bar, it dared to select everything in it
as if any creepy browser would do! The first thing I did is to check
the &lt;code&gt;clickSelectsAll&lt;/code&gt; pref -- what I always do first after getting a
new install of Firefox on Windows is setting this pref to &lt;code&gt;false&lt;/code&gt;,
and setting &lt;code&gt;doubleClickSelectsAll&lt;/code&gt; pref to &lt;code&gt;true&lt;/code&gt;: that is the default
behaviour for Firefox on GNU/Linux... that time at least...&lt;/p&gt;
&lt;p&gt;Much to my disappointment, the pref are setting correctly, but nothing
works. I tried to search for this, but without success, maybe since
this bug was so new, or I was to silly to apply the right keywords
(huh, maybe the latter one?). So I created an account on Mozilla&amp;#39;s
bugtracker just to open &lt;a href=&#34;https://bugzilla.mozilla.org/show_bug.cgi?id=1629135&#34;&gt;a bug&lt;/a&gt;. At the same time I switched
back to the ESR version of Firefox, which rid me (till recently) of
this stupid address bar but still granted me security updates. A
few days ago, however, Firefox ESR was unfortunately eventually shipped
with this bug, calling for a solution.&lt;/p&gt;
&lt;a id=&#34;more&#34;&gt;&lt;/a&gt;
&lt;h1 id=&#34;Some-more-background&#34;&gt;&lt;a href=&#34;#Some-more-background&#34; class=&#34;headerlink&#34; title=&#34;Some more background&#34;&gt;&lt;/a&gt;Some more background&lt;/h1&gt;&lt;p&gt;Here I will add more background because I need to complain a lot (&amp;gt;w&amp;lt;).
If you would like to see the solution directly, &lt;a href=&#34;#The-solution&#34;&gt;jump there&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Someone on bugzilla pointed out that the bug had been
&lt;a href=&#34;https://bugzilla.mozilla.org/show_bug.cgi?id=1621570&#34;&gt;raised by someone else&lt;/a&gt;. Following that bug, I saw that
the developer was being pretty toxic and just marked it as &lt;code&gt;WONTFIX&lt;/code&gt;,
despite many people criticized the buggy behaviour and regarded
the original behaviour as signature of Firefox. I finally switched
from Ubuntu to Gentoo after the new ESR, as I would like to have more
control of my software.&lt;/p&gt;
&lt;p&gt;Yesterday I &lt;a href=&#34;https://matrix.to/#/!NREUQXSZzhWoQFQpTe:matrix.org/$16014845914171808dKKcm:matrix.org?via=matrix.org&amp;amp;via=tusooa.xyz&#34;&gt;talked&lt;/a&gt; to &lt;a href=&#34;https://outsideofinfinity.wordpress.com/&#34;&gt;tiar&lt;/a&gt; about the freedom
of users to make software behave the way they want, without necessarily
being a developer. I complained that many free/libre software does not
excel in this aspect, using Firefox &gt;=75 as an example.&lt;/p&gt;
&lt;p&gt;The thing Firefox developers does, by removing the &lt;code&gt;clickSelectsAll&lt;/code&gt;
prefs, is actually somewhat limiting users&amp;#39; freedom, as customization
becomes harder and harder. This kind of freedom has been brought up
by a KDE person as &lt;a href=&#34;https://phabricator.kde.org/T11091&#34;&gt;a goal&lt;/a&gt; called &amp;quot;freedom out of the box.&amp;quot;
In short, it aims to make changing the behaviour of a program
as easy as just using it, probably unifying the interface where a program
is used and where a program is customized.&lt;/p&gt;
&lt;p&gt;And that is reasonable: no one should have to spend quite a long time
reading an extraordinarily large code base just to make a tiny little
change that would significantly improve their lives. We will simply not
have that much time. I know tweaking system is fun... (should I say
addictive?) but still, instant result is always a good-to-have.&lt;/p&gt;
&lt;h1 id=&#34;The-solution&#34;&gt;&lt;a href=&#34;#The-solution&#34; class=&#34;headerlink&#34; title=&#34;The solution&#34;&gt;&lt;/a&gt;The solution&lt;/h1&gt;&lt;p&gt;For Firefox, we do have a &lt;a href=&#34;https://superuser.com/questions/540851/go-back-to-not-selecting-the-whole-url-when-i-click-the-address-bar&#34;&gt;solution&lt;/a&gt; without needing to
recompile. That is, to change the &lt;code&gt;omni.ja&lt;/code&gt; pack in the Firefox
distribution. Based on that I managed to restore the old good
urlbar behaviour.&lt;/p&gt;
&lt;p&gt;For my &lt;code&gt;firefox-bin&lt;/code&gt; on Gentoo, the relevant file is at
&lt;code&gt;/opt/firefox/browser/omni.ja&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;First make a copy of that file:&lt;/p&gt;
&lt;figure class=&#34;highlight bash&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;cp -v /opt/firefox/browser/omni.ja omni.ja.orig&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;Then unzip the file:&lt;/p&gt;
&lt;figure class=&#34;highlight bash&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;mkdir omni &amp;amp;&amp;amp; unzip -d omni /opt/firefox/browser/omni.ja&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;It may return 2, but does not matter.&lt;/p&gt;
&lt;p&gt;Then edit the &lt;code&gt;modules/UrlbarInput.jsm&lt;/code&gt;:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;p&gt;Change&lt;/p&gt;
&lt;figure class=&#34;highlight javascript&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;built_in&#34;&gt;this&lt;/span&gt;._preventClickSelectsAll = &lt;span class=&#34;built_in&#34;&gt;this&lt;/span&gt;.focused;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;to&lt;/p&gt;
&lt;figure class=&#34;highlight javascript&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;built_in&#34;&gt;this&lt;/span&gt;._preventClickSelectsAll = &lt;span class=&#34;literal&#34;&gt;true&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;to get the &lt;code&gt;clickSelectsAll&lt;/code&gt; behaviour.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Change&lt;/p&gt;
&lt;figure class=&#34;highlight javascript&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt; (event.target.id == SEARCH_BUTTON_ID) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;to&lt;/p&gt;
&lt;figure class=&#34;highlight javascript&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt; (event.detail == &lt;span class=&#34;number&#34;&gt;2&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;built_in&#34;&gt;this&lt;/span&gt;.select();&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  event.preventDefault();&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125; &lt;span class=&#34;keyword&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt; (event.target.id == SEARCH_BUTTON_ID) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;to get the &lt;code&gt;doubleClickSelectsAll&lt;/code&gt; behaviour.&lt;/p&gt;
&lt;p&gt;Note that this will &lt;em&gt;not&lt;/em&gt; put the url into primary selection
upon double click. This can be useful sometimes, if you just
would like to replace the current url with the one currently
in primary selection.
If you would like to put the url into primary selection
upon double click, which completely restores the original
behaviour, change it to&lt;/p&gt;
&lt;figure class=&#34;highlight javascript&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt; (event.detail == &lt;span class=&#34;number&#34;&gt;2&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;built_in&#34;&gt;this&lt;/span&gt;.inputField.select();&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  event.preventDefault();&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125; &lt;span class=&#34;keyword&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt; (event.target.id == SEARCH_BUTTON_ID) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;instead.&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;I have also made a patch:
&lt;figure class=&#34;highlight bash&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;26&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;] diff -Naur omni-old omni&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;diff -Naur omni-old/modules/UrlbarInput.jsm omni/modules/UrlbarInput.jsm&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;--- omni-old/modules/UrlbarInput.jsm    2010-01-01 00:00:00.000000000 -0500&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;+++ omni/modules/UrlbarInput.jsm        2020-10-01 19:50:41.925266392 -0400&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;@@ -2225,7 +2225,7 @@&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;         &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;         this.focusedViaMousedown = !this.focused;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;-        this._preventClickSelectsAll = this.focused;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;+        this._preventClickSelectsAll = &lt;span class=&#34;literal&#34;&gt;true&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;         &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt; (event.target != this.inputField) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;           this.focus();&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;@@ -2242,7 +2242,11 @@&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;           this.selectionStart = this.selectionEnd = 0;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;         &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;-        &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt; (event.target.id == SEARCH_BUTTON_ID) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;+        // doubleClickSelectsAll&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;+        &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt; (event.detail == 2) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;+          this.select();&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;+          event.preventDefault();&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;+        &amp;#125; &lt;span class=&#34;keyword&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt; (event.target.id == SEARCH_BUTTON_ID) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;           this._preventClickSelectsAll = &lt;span class=&#34;literal&#34;&gt;true&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;           this.search(UrlbarTokenizer.RESTRICT.SEARCH);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;         &amp;#125; &lt;span class=&#34;keyword&#34;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;There is also the search bar to change. The original Superuser answer
suggests this, but as I do not use the search bar, I have not
tried it out, nor do I know what the original behaviour of it was.
&lt;figure class=&#34;highlight bash&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;sed -i &lt;span class=&#34;string&#34;&gt;&amp;#x27;s/this\._preventClickSelectsAll = this\._textbox\.focused;/this._preventClickSelectsAll = true;/&amp;#x27;&lt;/span&gt;  omni/chrome/browser/content/browser/search/searchbar.js&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;After editing, we need to re-pack the files:
&lt;figure class=&#34;highlight bash&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;built_in&#34;&gt;cd&lt;/span&gt; omni &amp;amp;&amp;amp; zip -0DXqr ../omni.ja * &amp;amp;&amp;amp; &lt;span class=&#34;built_in&#34;&gt;cd&lt;/span&gt; -&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;And replace the original one:
&lt;figure class=&#34;highlight bash&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;cp -v omni.ja /opt/firefox/browser/omni.ja&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;You may need to change the ownership of the newly-created archive:
&lt;figure class=&#34;highlight bash&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;chown [U]:[G] /opt/firefox/browser/omni.ja&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
where &lt;code&gt;[U]&lt;/code&gt; and &lt;code&gt;[G]&lt;/code&gt; refers to the owner and group of the original
file (we made a backup at &lt;code&gt;omni.ja.orig&lt;/code&gt;).&lt;/p&gt;
&lt;p&gt;To ensure everything takes effect, make a file called &lt;code&gt;.purgecaches&lt;/code&gt;
to make Firefox aware of the changes:
&lt;figure class=&#34;highlight bash&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;touch /opt/firefox/browser/.purgecaches&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;Okay, from now on, we shall no longer suffer from the &lt;code&gt;clickSelectsAll&lt;/code&gt;
bug.&lt;/p&gt;
&lt;p&gt;Also, you may want to have additional configurations, such as
&lt;a href=&#34;https://www.userchrome.org/megabar-styling-firefox-address-bar.html&#34;&gt;disabling the pop-up list upon clicking address bar&lt;/a&gt;
or &lt;a href=&#34;https://github.com/WesleyBranton/Remove-Firefox-Megabar/blob/master/remove_megabar.css&#34;&gt;gettind rid of the address bar expanding effect&lt;/a&gt;
when clicked upon.&lt;/p&gt;
</content>
        <category term="firefox" />
        <category term="无奈" />
        <category term="坑" />
        <category term="javascript" />
        <updated>2020-10-02T00:15:56.000Z</updated>
    </entry>
</feed>
